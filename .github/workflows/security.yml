# Security Audit
# Scans for known vulnerabilities in dependencies

name: Security

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  schedule:
    # Run weekly on Sunday at 00:00 UTC
    - cron: '0 0 * * 0'

# Cancel stale PR runs when new commits are pushed
# Never cancel main branch runs (protects scheduled security scans)
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: ${{ github.ref != 'refs/heads/main' }}

jobs:
  # ====================
  # cargo-audit
  # ====================
  audit:
    name: Security Audit
    runs-on: ubuntu-latest
    timeout-minutes: 10  # cargo-audit check
    steps:
      - name: Checkout repository
        uses: actions/checkout@v6

      - name: Install Rust toolchain
        uses: dtolnay/rust-toolchain@stable

      - name: Install cargo-audit
        uses: taiki-e/install-action@cargo-audit

      - name: Run security audit
        run: cargo audit

  # ====================
  # cargo-deny
  # ====================
  deny:
    name: Dependency Check
    runs-on: ubuntu-latest
    timeout-minutes: 10  # cargo-deny check
    steps:
      - name: Checkout repository
        uses: actions/checkout@v6

      - name: Run cargo-deny
        uses: EmbarkStudios/cargo-deny-action@v2
